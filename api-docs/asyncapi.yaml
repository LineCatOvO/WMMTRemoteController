asyncapi: 2.6.0
info:
  title: Input Script Runtime Protocol
  version: 1.0.0
  description: |
    WebSocket protocol between Android Input Runtime and Backend.
    This protocol defines how input frames are transmitted from the client to the server.

servers:
  production:
    url: ws://{host}:{port}/ws/input
    protocol: ws
    variables:
      host:
        default: localhost
      port:
        default: "8080"

channels:
  input/frame:
    publish:
      summary: Input frame sent from client
      description: |
        One input frame generated by the Script Runtime. 
        Sent by the client at approximately 60 FPS.
      message:
        $ref: '#/components/messages/InputFrame'

components:
  messages:
    InputFrame:
      name: InputFrame
      description: |
        A single input frame containing keyboard, mouse, joystick, and gyroscope data.
        Generated by the Script Runtime after processing raw input through the active profile script.
      payload:
        $ref: '#/components/schemas/InputFramePayload'

  schemas:
    InputFramePayload:
      type: object
      required: [keyboard, mouse, joystick, gyroscope]
      properties:
        frameId:
          type: integer
          description: Monotonic frame identifier, used to prevent out-of-order processing
          example: 12345
        runtimeStatus:
          type: string
          enum: [ok, degraded, rollback]
          description: Runtime status, indicating the health of the script runtime
          default: ok
          example: ok
        keyboard:
          $ref: '#/components/schemas/KeyboardState'
        mouse:
          $ref: '#/components/schemas/MouseState'
        joystick:
          $ref: '#/components/schemas/JoystickState'
        gyroscope:
          $ref: '#/components/schemas/GyroscopeState'

    KeyboardState:
      type: array
      items:
        type: string
      description: List of currently pressed keyboard keys
      example: ["W", "A"]

    MouseState:
      type: object
      properties:
        x:
          type: number
          description: Mouse X position (normalized 0-1)
          example: 0.5
        y:
          type: number
          description: Mouse Y position (normalized 0-1)
          example: 0.3
        left:
          type: boolean
          description: Left mouse button state
          example: true
        right:
          type: boolean
          description: Right mouse button state
          example: false
        middle:
          type: boolean
          description: Middle mouse button state
          example: false

    JoystickState:
      type: object
      properties:
        x:
          type: number
          description: Joystick X axis value (-1 to 1)
          example: 0.75
        y:
          type: number
          description: Joystick Y axis value (-1 to 1)
          example: -0.25

    GyroscopeState:
      type: object
      properties:
        pitch:
          type: number
          description: Gyroscope pitch angle (degrees)
          example: 15.5
        roll:
          type: number
          description: Gyroscope roll angle (degrees)
          example: -10.2
        yaw:
          type: number
          description: Gyroscope yaw angle (degrees)
          example: 5.7
